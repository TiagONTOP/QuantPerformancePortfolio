# BENCHMARKS.md â€” Detailed Performance Analysis

This document presents the quantitative benchmark results comparing the CPU implementation (NumPy) to the GPU implementation (CuPy), based on real test data from `tests/benchmark_results.txt`.

The results are generated by running the comprehensive benchmark suite: `pytest tests/test_benchmark.py -v -s --tb=short`

**Main Conclusion:**
The GPU implementation (CuPy) achieves a **speedup of 13.7Ã—** over the optimized CPU (NumPy) version for end-to-end Asian option pricing.

Furthermore, by using the **zero-copy pipeline** (`device_output=True`), where all operations stay on GPU, the total **speedup reaches 42.0Ã—** over the baseline CPU implementation.

---

## ğŸ–¥ï¸ Test Environment

- **CPU:** Intel Core i7-4770 (Haswell) @ 4.1 GHz (Overclocked)
- **RAM:** 16 GB DDR3 @ 2400 MHz
- **GPU:** NVIDIA GeForce GTX 980 Ti (Maxwell, Overclocked)
- **Compute Capability:** 5.2
- **Libraries:** NumPy 2.2.1, CuPy 13.3.0, CUDA 12.x

---

## ğŸ“Š Summary Table

All benchmarks measure **end-to-end Asian option pricing** (simulation + pricing).

| Problem Size | Backend/Pipeline | Time (s) | Speedup vs CPU |
|--------------|------------------|----------|----------------|
| **Small** (10k Ã— 252) | CPU (float64) | 0.0985 | 1.0Ã— |
| | GPU (float32) | **0.0083** | **11.9Ã—** |
| **Medium** (100k Ã— 252) | CPU (float32) | 1.1602 | 1.0Ã— |
| | GPU (float32) | **0.0842** | **13.8Ã—** |
| **Large** (500k Ã— 252) | CPU (float32) | 4.7850 | 1.0Ã— |
| | GPU Standard | **0.3485** | **13.7Ã—** |
| | **GPU Zero-Copy** | **0.1141** | **42.0Ã—** âš¡ |

---

## âš¡ 1. Core Speedup â€” Standard GPU Pipeline

**Scenario:** 500,000 paths Ã— 252 steps, `float32`

| Component | CPU | GPU | Speedup |
|-----------|-----|-----|---------|
| **Simulation** | 4.722 s | 0.298 s | **15.9Ã—** |
| **Pricing** | 0.063 s | 0.051 s | 1.2Ã— |
| **Total** | **4.785 s** | **0.349 s** | **13.7Ã—** |

> **Insight:** The "drop-in" CuPy replacement yields 13.7Ã— speedup with minimal code changes.

---

## ğŸš€ 2. Zero-Copy Pipeline â€” The Game Changer

| Pipeline | Time | vs Standard | vs CPU |
|----------|------|-------------|--------|
| **CPU Baseline** | 4.785 s | - | 1.0Ã— |
| **GPU Standard** | 0.349 s | 1.0Ã— | 13.7Ã— |
| **GPU Zero-Copy** | **0.114 s** | **3.06Ã—** | **42.0Ã—** |

**Transfer time eliminated:** 156 ms

> **Critical Finding:** Memory transfer costs 156ms â€” more than the entire zero-copy computation (114ms). Zero-copy architecture is essential for maximum performance.

---

## ğŸ¯ 3. Precision Effect â€” float32 vs float64

**Scenario:** 500k paths, GPU

| Dtype | Time | vs float32 |
|-------|------|------------|
| **float32** | 0.367 s | 1.0Ã— |
| **float64** | 0.666 s | **1.81Ã— slower** |

> **Recommendation:** Use float32 for production (1.81Ã— faster, sufficient precision for Monte Carlo).

---

## ğŸ“ˆ 4. Scalability â€” All Problem Sizes

| Size | CPU | GPU | Speedup |
|------|-----|-----|---------|
| 10k paths | 0.0985 s | 0.0083 s | **11.9Ã—** |
| 100k paths | 1.1602 s | 0.0842 s | **13.8Ã—** |
| 500k paths | 4.7850 s | 0.3485 s | **13.7Ã—** |

> **Conclusion:** GPU wins at all scales â€” even 10k paths shows 11.9Ã— speedup.

---

## ğŸ† Summary

| Metric | Value |
|--------|-------|
| **Peak Speedup (Standard)** | 13.7Ã— |
| **Peak Speedup (Zero-Copy)** | 42.0Ã— |
| **Precision Advantage** | 1.81Ã— (float32 vs float64) |
| **Scalability** | 11.9Ã— â€“ 13.8Ã— across all sizes |

### Production Recommendations

- âœ… Always use `device_output=True` for zero-copy
- âœ… Use `dtype=np.float32` for maximum performance
- âœ… GPU wins at all scales â‰¥10k paths
- âœ… Total speedup: **42Ã— vs CPU baseline**

---

*Based on verified benchmark results from `tests/benchmark_results.txt`*
